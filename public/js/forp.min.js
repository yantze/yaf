/** forp-ui (c) 2013 Anthony Terrien **/
if(typeof jMicro=='undefined'){(function(w){"use strict"
var undef='undefined',cssNumber={"columnCount":true,"fillOpacity":true,"fontWeight":true,"lineHeight":true,"opacity":true,"order":true,"orphans":true,"widows":true,"zIndex":true,"zoom":true};w.jMicro=function(selector,attr){return new $(selector,attr);};w.jMicro.fn=w.jMicro.prototype={selector:null,length:0,construct:function(selector,attr){var nodes=[];if(!selector)selector=[];if(selector instanceof $)return selector;if(typeof(selector)=='string'){var strim=selector.trim(),striml=strim.length;if(strim.charAt(0)=='<'&&strim.charAt(striml-1)=='>'){var pnode='DIV';if(strim.indexOf("<t")==0){if(strim.indexOf("<tr>")==0||strim.indexOf("<thead>")==0||strim.indexOf("<tbody>")==0){pnode='TABLE';}else if(strim.indexOf("<td>")==0||strim.indexOf("<th>")==0){pnode='TR';}
var fragment=document.createDocumentFragment(),snode=strim.substring(1,striml-1);fragment.appendChild(w.document.createElement(snode));nodes=fragment.childNodes;}else{var parent=w.document.createElement(pnode);parent.innerHTML=strim;nodes=parent.childNodes;}}else if(selector){this.selector=selector;try{nodes=document.querySelectorAll(selector);}catch(error){}}}else if(selector.nodeType||selector==w){nodes=[selector];}else{nodes=selector;}
for(var i=0;i<nodes.length;i++){var node=nodes[i];if(node instanceof $)node=node[0];this[this.length++]=node;}
if(attr){for(var fn in attr)this[fn](attr[fn]);}
return this;},is:function(state){if(state==':visible'){return this[0].style.display!='none';}},find:function(selector){return new $(this[0].querySelectorAll(selector));},get:function(index){return this[index];},eq:function(index){this.length=1;this[0]=this.get(index);return this;},clone:function(){var nodes=[];this.each(function(){nodes.push(this.cloneNode(true));});return new $(nodes);},replaceWith:function(content){this.prepend(content);return this.each(function(){this.parentNode.removeChild(this);});},on:function(event,fn){return this.bind(event,fn);},live:function(){return this.bind(event,fn);},bind:function(event,fn){var self=this;return this.each(function(){if(!this.events)this.events={};if(!this.events[event])this.events[event]=[];this.events[event].push(fn);if(this.addEventListener){this.addEventListener(event,function(e){self.trigger(e);},false);}else if(this.attachEvent){this.attachEvent("on"+event,function(e){self.trigger(e);});}});},unbind:function(event,fn){return this.each(function(){if(this.events&&this.events[event]){if(this.removeEventListener){this.removeEventListener(event,fn,false);}else if(this.detachEvent){this.detachEvent("on"+event,fn);}
for(var i in this.events[event]){if(this.events[event][i]==fn){this.events[event].splice(i,1);return this;};}}});},trigger:function(event){var name=event.type?event.type:event;return this.each(function(){if(this.events&&this.events[name]){for(var fn in this.events[name]){this.events[name][fn].apply(this,[event]);}}});},blur:function(fn){return this.bind('blur',fn);},change:function(fn){return this.bind('change',fn);},click:function(fn){return this.bind('click',fn);},dblclick:function(fn){return this.bind('dblclick',fn);},focus:function(fn){return this.bind('focus',fn);},keydown:function(fn){return this.bind('keydown',fn);},keyup:function(fn){return this.bind('keyup',fn);},keypress:function(fn){return this.bind('keypress',fn);},mousedown:function(fn){return this.bind('mousedown',fn);},mouseenter:function(fn){return this.bind('mouseenter',fn);},mouseleave:function(fn){return this.bind('mouseleave',fn);},mousemove:function(fn){return this.bind('mousemove',fn);},mouseout:function(fn){return this.bind('mouseout',fn);},mouseover:function(fn){return this.bind('mouseover',fn);},mouseup:function(fn){return this.bind('mouseup',fn);},resize:function(fn){return this.bind('resize',fn);},scroll:function(fn){return this.bind('scroll',fn);},select:function(fn){return this.bind('select',fn);},submit:function(fn){return this.bind('submit',fn);},focusin:function(fn){return this.bind('focusin',fn);},focusout:function(fn){return this.bind('focusout',fn);},load:function(fn){return this.bind('load',fn);},unload:function(fn){return this.bind('unload',fn);},ready:function(fn){if(document.addEventListener){document.addEventListener('DOMContentLoaded',fn,false);}else if(/KHTML|WebKit|iCab/i.test(navigator.userAgent)){var DOMLoadTimer=setInterval(function(){if(/loaded|complete/i.test(document.readyState)){fn();clearInterval(DOMLoadTimer);}},10);}else{window.onload=fn;}},html:function(value){return this.each(function(){this.innerHTML=value;});},text:function(value){return this.each(function(){this.innerHTML=value.replace(/</g,'&lt;').replace(/>/g,'&gt;');});},prepend:function(nodes){if(!(nodes instanceof $))nodes=new $(nodes);return this.each(function(){var self=this;nodes.each(function(){self.insertBefore(this,self.firstChild);});});},append:function(nodes){if(!(nodes instanceof $))nodes=new $(nodes);return this.each(function(){var self=this;nodes.each(function(){self.appendChild(this);});});},appendTo:function(nodes){if(!(nodes instanceof $))nodes=new $(nodes);return this.each(function(){var self=this;nodes.each(function(){this.appendChild(self);});});},remove:function(){return this.each(function(){this.parentNode.removeChild(this);});},empty:function(){return this.html('');},insertAfter:function(element){this[0].parentNode.insertBefore(element[0],this[0].nextSibling);return this;},attr:function(attr,val){if(typeof val==undef){if(typeof attr=='object'){for(var key in attr)this.attr(key,attr[key]);return this;}else{return typeof this[0][attr]==undef?this[0].getAttribute(attr):this[0][attr];}}
return this.each(function(){this.setAttribute(attr,val);});},id:function(val){return this.attr('id',val);},class:function(val){return this.attr('class',val);},val:function(val){return this.attr('value',val);},data:function(attr,val){if(typeof val==undef){return this[0]['$'+attr];}
return this.each(function(){this['$'+attr]=val;});},removeData:function(attr){return this.data(attr,null);},css:function(name,val){if(typeof val==undef){if(typeof name=='object'){for(var key in name)this.css(key,name[key]);return this;}else{return this[0].style[name];}}
if(!isNaN(val)&&!cssNumber[name])val+='px';return this.each(function(){this.style[name]=val;});},show:function(){return this.css({display:'block'});},hide:function(){return this.css({display:'none'});},height:function(val){return(typeof val!=undef)?this.css('height',val):this[0].offsetHeight;},width:function(val){return(typeof val!=undef)?this.css('width',val):this[0].offsetWidth;},outerWidth:function(val){return this.width(val);},addClass:function(c){var cArr=c.split(' '),l=cArr.length;return this.each(function(){for(var i=0;i<l;i++){this.classList.add(cArr[i]);}});return this;},hasClass:function(c){return this[0].classList.contains(c);},removeClass:function(c){return this.each(function(){for(var k in this.classList){if(this.classList[k]==c){this.classList.remove(c);}}});},top:function(){return this.offset().top;},left:function(){return this.offset().left;},position:function(value){if(typeof value!=undef){return this.css({position:'fixed',top:'50%',left:'50%',marginLeft:-(this.width()/2),marginTop:-(this.height()/2)});}
if(this.length>0){return{left:this[0].offsetLeft,top:this[0].offsetTop};}else{return{left:0,top:0};}},offset:function(){if(this.length==0)return{left:0,top:0};var result=this.position(),e=this[0];while(e=e.offsetParent){result.left+=e.offsetLeft;result.top+=e.offsetTop;}
return result;},parent:function(){return new $(this[0].parentNode);},next:function(){return new $(this[0].nextSibling);}};w.jMicro.fn.construct.prototype=w.jMicro.fn;w.jMicro.extend=w.jMicro.fn.extend=function(){var len=arguments.length,target,start=0;var deep=false;if(len==1){for(var entry in arguments[0]){var obj=arguments[0][entry];if(typeof obj!='function'&&obj instanceof Object){w.jMicro[entry]=w.jMicro.extend(w.jMicro.fn[entry],obj);}else{w.jMicro[entry]=w.jMicro.fn[entry]=obj;}}
return w.jMicro;}else{if(arguments[0]===true){deep=true;start++;}
target=arguments[start];if(!target)target={};}
if(arguments[len-1]===true){deep=true;len--;}
for(var i=start+1;i<len;i++){var obj=arguments[i];for(var entry in obj){if(deep&&typeof obj[entry]!='function'&&obj[entry]instanceof Object&&!(obj[entry]instanceof Document)){target[entry]=this.extend(target[entry],obj[entry]);}else{target[entry]=obj[entry];}}}
return target;};w.jMicro.extend({each:function(scope,fn){if(typeof fn==undef){fn=scope;scope=this;}
for(var i=0;i<scope.length;i++){var node=scope[i];fn.apply(node,[i,node]);}
return scope;}});var $=w.jMicro.fn.construct;w.jMicro.support={};})(this);}
if(typeof forp=="undefined"){var forp={};}
if(typeof forp.plugins=="undefined"){forp.plugins={};}
(function(forp,$){"use strict";$.fn.forp=function(options){options=$.extend({stack:[],mode:"embedded"},options);(new forp.Controller({parent:this[0],mode:options.mode})).setStack(options.stack).run();};})(forp,jMicro);(function(forp,$){"use strict";$.fn.scrollBottom=function(){return this.each(function(){this.scrollTop=$(this.firstChild).height();});};$.table=function(headers){var $table=$('<table>');if(headers){var $header=$("<tr>");for(var i in headers){$("<th>").text(headers[i]).appendTo($header);}
$header.appendTo($table);}
return $table;};$.fn.line=function(cols){var $tr=$('<tr>');for(var i in cols){if(typeof cols[i]==="object"){$tr.append($("<td>").append(cols[i]));}else if(isNaN(cols[i])){$tr.append($("<td>").html(cols[i]));}else{$tr.append($("<td>").addClass("numeric w100").html(cols[i]));}}
$(this).append($tr);return $tr;};$.Utils={trimPath:function(path)
{var pathSplit=path.split('/');if(pathSplit.length>3){pathSplit=[pathSplit[pathSplit.length-4],pathSplit[pathSplit.length-3],pathSplit[pathSplit.length-2],pathSplit[pathSplit.length-1]];path=pathSplit.join('/');}
return path;},htmlEntities:function(str){return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}};$.SortedFixedArray=function(compare,size){this.stack=[];this.size=size;this.insert=function(entry,i){for(var j=Math.min(this.size-1,this.stack.length);j>i;j--){this.stack[j]=this.stack[j-1];}
this.stack[i]=entry;}
this.put=function(entry){if(this.stack.length){if(this.stack.length==this.size){if(!compare.call(this,entry,this.stack[this.size-1])){return;}}
for(var i=0;i<this.stack.length;i++){if(compare.call(this,entry,this.stack[i])){this.insert(entry,i);break;}}
if((i==this.stack.length)&&(this.stack.length<this.size)){this.insert(entry,i);}}else{this.insert(entry,0);}};};$.round=function(v)
{return(~~(0.5+(v*1000)))/1000;};$.roundDiv=function(v,d)
{return this.round(v/d);};$.inArray=function(needle,haystack){var length=haystack.length;for(var i=0;i<length;i++){if(haystack[i]==needle)return true;}
return false;};forp.Decorator=function($container)
{var self=this;this.$=$container;this.element=$container[0];this.unbind=function(event,fn)
{self.$.unbind(event,fn);return this;};this.appendTo=function(container)
{this.$.appendTo(container.$);return this;};this.append=function(element)
{this.$.append(element.$);return this;};this.empty=function()
{this.$.empty();return this;};this.attr=function(k,v)
{this.$.attr(k,v);return this;};};forp.Nav=function()
{forp.Decorator.call(this,$("<nav>"));};forp.Panel=function(id)
{forp.Decorator.call(this,$("<div>"));this.$.class(id+" panel");this.id=id;};})(forp,jMicro);(function(forp,$){"use strict";forp.Controller=function(conf)
{var self=this;var conf=conf||{};this.layout=null;this.console=null;this.grader=null;this.tree=null;this.stack=null;this.openEventListener=null;this.viewMode=conf.parent?conf.mode||"embedded":"fixed";this.parent=conf.parent;this.cpuHistogram=null;this.memoryHistogram=null;this.groupsBarChart=null;forp.getController=function(){return self;};this.setViewMode=function(viewMode)
{this.viewMode=viewMode;return this;};this.hasStack=function()
{return this.stack!=null;};this.setStack=function(stack)
{this.stack=new forp.Stack(stack);return this;};this.getStack=function()
{return this.stack;};this.getGroupsBarChart=function()
{if(!this.groupsBarChart){var groups=self.getStack().groups,datas=[];for(var group in self.getStack().groups){datas.push({label:group,value:groups[group].usec});}
this.groupsBarChart=(new forp.BarChart({xaxis:{min:0,max:self.getStack().getMainEntry().usec},yaxis:{length:50,min:0,max:1},val:function(i){return this.datas[i].value;},color:function(i){return forp.TagRandColor.provideFor(this.datas[i].label);}})).setDatas(datas).draw();}
return this.groupsBarChart;}
this.getCpuHistogram=function()
{if(!this.cpuHistogram){this.cpuHistogram=(new forp.Histogram({xaxis:{min:0},yaxis:{length:50,min:0,max:self.getStack().getTopCpu()[0].usec},val:function(i){return this.datas[i].usec;},mousemove:function(e){var x=Math.floor((e.offsetX*this.$.width())/this.$.width()),y=this.conf.yaxis.length
-((e.offsetY*this.$.height())/this.$.height());for(var i=x-10;i<x+10;i++){if(!this.datas[i])continue;var entry=this.datas[i],amp=(entry.usec*100)/this.conf.yaxis.max;if(y<=amp){this.highlight(i);return;}}
this.restore();}})).setDatas(self.getStack().leaves).draw();}
return this.cpuHistogram;}
this.getMemoryHistogram=function()
{if(!this.memoryHistogram){this.memoryHistogram=(new forp.Histogram({width:this.getConsole().$.width(),xaxis:{min:0},yaxis:{length:50,min:0,max:self.getStack().getTopMemory()[0].bytes},val:function(i){return this.datas[i].bytes;},mousemove:function(e){var x=Math.floor((e.offsetX*this.$.width())/this.$.width()),y=this.conf.yaxis.length
-((e.offsetY*this.$.height())/this.$.height());for(var i=x-10;i<x+10;i++){if(!this.datas[i])continue;var entry=this.datas[i],amp=(entry.bytes*100)/this.conf.yaxis.max;if(y<=amp){this.highlight(i);return;}}
this.restore();}})).setDatas(self.getStack().leaves).draw();}
return this.memoryHistogram;}
this.getConsole=function()
{return this.layout.getConsole();};this.getLayout=function()
{if(!this.layout){this.layout=new forp.Layout($('<div>'),this.viewMode);this.parent.insertBefore(this.layout.element,this.parent.firstChild);}
return this.layout;};this.getGrader=function()
{if(!this.grader)this.grader=new forp.Grader();return this.grader;};this.run=function()
{if(!self.hasStack()){throw{name:"RuntimeError",message:"Stack undefined."}}
if(self.getStack().stack.length>30000){throw new RangeError("More than 30000 entries in the stack ("+self.getStack().stack.length+").");}
$('head').append($('<style>').text('#forp *{margin:0;padding:0;border:0;font-family:sans-serif;font-size:1em;font-weight:normal;font-style:normal;text-decoration:none;width:auto;height:auto;color:#222;line-height:1.3}#forp{position:relative;font-weight:300;max-width:300px;background:#fff;font-size:12px}#forp div.inset{height:10px;position:absolute;top:0px;left:0px;right:0px;-webkit-box-shadow:inset 0 3px 5px -2px #aaa;-moz-box-shadow:inset 0 3px 5px -2px #aaa;box-shadow:inset 0 3px 5px -2px #aaa}#forp.forp-fixed{height:70%;position:fixed;bottom:0px;right:0px;z-index:2147483647}#forp.forp-fixed-compact{position:fixed;bottom:0px;right:0px;z-index:2147483647;width:150px;opacity:.6;cursor:pointer;margin:15px;border-radius:8px;-moz-box-shadow:0 0 8px #ccc;-webkit-box-shadow:0 0 8px #ccc;box-shadow:0 0 8px #ccc}#forp.forp-fixed-compact:hover{opacity:1}#forp.forp-fixed-compact nav{height:auto;padding:10px;border-radius:8px}#forp.forp-fixed-compact nav div{margin:3px 0px}#forp.forp-fixed,#forp.forp-embedded{min-width:1000px;max-width:100%;left:0px}#forp.forp-fixed a,#forp.forp-embedded a{display:inline}#forp.forp-fixed nav div,#forp.forp-embedded nav div{float:left}#forp.forp-fixed div.summary,#forp.forp-embedded div.summary{display:none}#forp div.backtrace{text-align:center;color:#aaa;margin:30px auto}#forp div.backtrace-item{color:#333;margin:0px 5px;padding:4px 5px 5px 5px;border-radius:8px;padding:5px;display:inline-block}#forp div.backtrace div.arrow{margin:5px;color:#999}#forp div.backtrace div.highlight{background:#4D90FE !important;color:#FFF !important}#forp div.backtrace div.highlight span{color:#FFF !important}#forp div.close:before{content:"x"}#forp div.close{color:#ccc;position:absolute;top:14px;right:30px}#forp div.close:hover{cursor:pointer}#forp div.console{position:relative;float:left;width:100%}#forp div.gauge{position:relative;background:#eee;color:#333;margin:1px;width:110px;text-align:right}#forp div.gauge div.bar{background:#59f;height:18px}#forp div.gauge div.text{position:absolute;top:0px;right:4px;line-height:1.8;font-size:.9em}#forp td div.gauge{margin:0px}#forp div.grade,#forp div.grade-A,#forp div.grade-B,#forp div.grade-C,#forp div.grade-D,#forp div.grade-E{padding:2px 5px;display:inline-block;border-radius:3px;font-size:0.8em;color:#FFF;margin-right:10px}#forp div.grade-A{background-color:#9E5}#forp div.grade-B{background-color:#EE5}#forp div.grade-C{background-color:#EB5}#forp div.grade-D{background-color:#E95}#forp div.grade-E{background-color:#E55}#forp ul.inspect{padding:10px 0px 0px 0px}#forp input[type=text]{padding:4px;border:1px solid #777;border-radius:3px;background:#fff}#forp nav{background:#fcfcfc;padding:14px 0px 8px 4px}#forp.forp-fixed nav,#forp.forp-embedded nav{height:22px}#forp a{white-space:nowrap;color:#FFF}#forp div.toggleOn,#forp div.toggleOff{margin:0px 5px;padding:4px;float:left;border-radius:2px}#forp div.toggleOn:hover,#forp div.toggleOff:hover{cursor:pointer}#forp div.toggleOn{color:#FFF;background:#4D90FE}#forp div.toggleOff{color:#FFF;background:#555}#forp div.sidebar{float:right}#forp div.w2of3{width:66% !important}#forp div.w1of3{width:33% !important}#forp ul{list-style:none;padding-left:20px}#forp ul.l0{padding-left:10px}#forp li{line-height:1.8 !important;margin:2px}#forp li div.numeric{min-width:60px;margin:0px 10px}#forp .indent{padding-left:30px}#forp li div.expander{text-align:center;width:20px;cursor:pointer}#forp li.expanded div.expander:before{content:"-"}#forp li.collapsed div.expander:before{content:"+"}#forp li.collapsed ul{display:none}#forp .left{float:left}#forp .right{float:right}#forp table{font-weight:300;width:100%;border-collapse:collapse}#forp th,#forp td{padding:5px}#forp th{text-align:center;font-weight:bold;color:#333;border:1px solid #ddd;background:#eee}#forp .w100{width:110px}#forp td{text-align:left;text-overflow:ellipsis;word-space:nowrap;overflow:hidden;vertical-align:top}#forp tr{color:#333;background:#fff}#forp tr.sub{background:#eee}#forp tr:hover{background:#EDF4FF}#forp tr[data-ref]{cursor:pointer}#forp .numeric{text-align:right}#forp a.tag{background:#EE0;color:#fff;font-size:0.8em;padding:2px 5px;margin:0px 5px}#forp a.tag,#forp a{border-radius:3px}#forp div.panel{overflow:auto;overflow-x:hidden}#forp{background:none}#forp *{font-family:Consolas, monaco, monospace;font-size:11px;color:#eee}#forp div.backtrace-item{word-wrap:break-word;max-width:90%;background:#777;padding:4px 10px 5px 10px}#forp div.backtrace div.highlight{background:#333 !important}#forp div.backtrace div.arrow{color:#ddd}#forp div.close:hover{color:#eee}#forp.forp-fixed{height:100%;background:#FFF;min-width:1000px;top:0px;left:0px}#forp.forp-fixed-compact{margin:0px;position:fixed;top:0px;right:0px;bottom:auto;border-radius:0;-moz-box-shadow:none;-webkit-box-shadow:none;box-shadow:none;width:130px}#forp.forp-fixed-compact nav{height:35px;text-align:right;padding:5px 10px;background:none;background-image:-webkit-linear-gradient(45deg, rgba(255, 255, 255, 0) 7%, #333 0%);background-image:-moz-linear-gradient(45deg, rgba(255, 255, 255, 0) 7%, #333 0%);background-image:-ms-linear-gradient(45deg, rgba(255, 255, 255, 0) 7%, #333 0%);background-image:-o-linear-gradient(45deg, rgba(255, 255, 255, 0) 7%, #333 0%);background-image:linear-gradient(45deg, rgba(255, 255, 255, 0) 7%, #333 0%);border-radius:0}#forp.forp-fixed-compact div.summary > div{color:#fff !important}#forp.forp-fixed-compact.grade-A{border-right:4px solid #9E5}#forp.forp-fixed-compact.grade-B{border-right:4px solid #EE5}#forp.forp-fixed-compact.grade-C{border-right:4px solid #EB5}#forp.forp-fixed-compact.grade-D{border-right:4px solid #E95}#forp.forp-fixed-compact.grade-E{border-right:4px solid #E55}#forp div.gauge{background:#777}#forp input[type=text]{border:1px solid #333;background:#333;margin:10px 5px}#forp input[type=text]:focus{background:#555}#forp div.inset{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none}#forp div.mainpanel{background:#666}#forp nav{background:#222;height:45px;padding:0px}#forp.forp-fixed nav,#forp.forp-embedded nav{height:45px}#forp div.toggleBar{min-width:1100px}#forp div.toggleOn,#forp div.toggleOff{height:21px;padding:15px 10px 5px 10px;min-width:100px;background:none;border-radius:0;margin:0px;border-bottom:4px solid #CCC;margin-right:1px}#forp div.toggleOn:hover,#forp div.toggleOff:hover{border-bottom:4px solid #FFF}#forp div.toggleOn{color:#EEE;border-bottom:4px solid #9E5;background-image:-webkit-linear-gradient(-135deg, rgba(255, 255, 255, 0) 7%, #555 0%);background-image:-moz-linear-gradient(-135deg, rgba(255, 255, 255, 0) 7%, #555 0%);background-image:-ms-linear-gradient(-135deg, rgba(255, 255, 255, 0) 7%, #555 0%);background-image:-o-linear-gradient(-135deg, rgba(255, 255, 255, 0) 7%, #555 0%);background-image:linear-gradient(-135deg, rgba(255, 255, 255, 0) 7%, #555 0%)}#forp div.toggleOff{color:#EEE;background-image:-webkit-linear-gradient(-135deg, rgba(255, 255, 255, 0) 5%, #333 0%);background-image:-moz-linear-gradient(-135deg, rgba(255, 255, 255, 0) 5%, #333 0%);background-image:-ms-linear-gradient(-135deg, rgba(255, 255, 255, 0) 5%, #333 0%);background-image:-o-linear-gradient(-135deg, rgba(255, 255, 255, 0) 5%, #333 0%);background-image:linear-gradient(-135deg, rgba(255, 255, 255, 0) 5%, #333 0%)}#forp tr:nth-child(even){background:#333}#forp tr:nth-child(odd){background:#444}#forp tr:hover{background:#777}#forp th,#forp td{padding:7px;border:none}#forp th{background:#999}'));this.parent=this.parent||document.body;self.getStack().aggregate();if(this.viewMode=="fixed"){this.getLayout().compact(this.onCompact);}else if(this.viewMode=="embedded"){this.open();}};this.onCompact=function(){if(self.getStack().stack.length>0){var ms=$.roundDiv(self.getStack().getMainEntry().usec,1000),kb=$.roundDiv(self.getStack().getMainEntry().bytes,1024),grader=new forp.Grader();self.getLayout().$.addClass(grader.getClass(grader.getGrade('time',ms))).bind("click",self.openEventListener=function(){self.getLayout().setViewMode('fixed');self.open();});$("<div>").class("summary").append($("<div>").attr("style","margin-right: 10px").text(ms+' ms ')).append($("<div>").attr("style","margin-right: 10px").text(kb+' Kb')).appendTo(self.getLayout().getNav().$);}else{$("<div>").text("Give me something to eat !").appendTo(self.getLayout().getNav());}};this.runOnReady=function()
{$(document).ready(function(){self.run();});},this.toggleDetails=function()
{var self=forp.getController(),target=$(this);if(target.attr("data-details")==1){target.next().remove();target.attr("data-details",0);return;}
target.attr("data-details",1);var id=target.attr("data-ref"),line=$("<tr>"),td=$("<td>").attr("colspan",4).appendTo(line),table=$.table(["called from"," ms","Kb"]).appendTo(td),lastId,loopCount,loopMaxIter=100;calledFrom:for(var i in self.getStack().getFunctions()[id].entries){for(var j in self.getStack().getFunctions()[id].entries[i].refs){if(!self.getStack().getFunctions()[id].entries[i].refs[j])continue;if(self.getStack().getFunctions()[id].entries[i].refs[j].id==lastId){loopCount++;}else{loopCount=0;}
lastId=self.getStack().getFunctions()[id].entries[i].refs[j].id;if(loopCount>=loopMaxIter){table.append($("<tr>").append($("<td>").attr("colspan",3).css("text-align","center").text(lastId+" : "+"too many items to display (>"+
loopMaxIter+")")));break calledFrom;}
table.line([self.getStack().getFunctions()[id].entries[i].refs[j].filelineno+
(self.getStack().getFunctions()[id].entries[i].refs[j].caption?"<br>"+self.getStack().getFunctions()[id].entries[i].refs[j].caption:""),$.Gauge(self.getStack().getFunctions()[id].entries[i].refs[j].usec,self.getStack().getFunctions()[id].getDuration(),1000,'ms'),$.Gauge(self.getStack().getFunctions()[id].entries[i].refs[j].bytes,self.getStack().getFunctions()[id].getMemory(),1024,'Kb')]).attr('data-ref',self.getStack().getFunctions()[id].entries[i].refs[j].i).bind('click',function(e){forp.getController().getConsole().showInSidebar((new forp.Backtrace($(this).attr("data-ref"),forp.getController().getStack().stack)).$).scrollBottom();});}}
target.insertAfter(line);};this.open=function()
{this.getLayout().unbind("click",this.openEventListener).open();$("<div>").class("inset").appendTo(this.getLayout().$);var $nav=$('<div>').class("toggleBar").appendTo(this.getLayout().getNav().$);for(var plugin in forp.plugins){if(forp.plugins[plugin]['nav']&&((typeof forp.plugins[plugin]['nav']['display']=='function'&&forp.plugins[plugin]['nav']['display']())||forp.plugins[plugin]['nav']['display']===true)){$nav.append(new forp.ToggleButton(forp.plugins[plugin]['nav']['label'],forp.plugins[plugin]['nav']['open'],forp.plugins[plugin]['nav']['close'],forp.plugins[plugin]['nav']['enabled']).$);}}
$nav.append($("<input>").attr("type","text").attr("name","forpSearch").attr("placeholder","Search ...").bind("click",function(e){$(this).parent().find("div.toggleOn").each(function(){$(this).class("toggleOff").attr("data-state","off")});}).bind("keyup",function(e){var controller=forp.getController(),$table=$.table(["function","calls","ms","Kb"]),datas=controller.getStack().search($(this).val().replace(/\\/g,"\\\\"));for(var i in datas){$table.line([datas[i].id,datas[i].calls,$.roundDiv(datas[i].getDuration(),1000).toFixed(3)+'',$.roundDiv(datas[i].getMemory(),1024).toFixed(3)+'']).attr("data-ref",datas[i].id).bind("click",controller.toggleDetails);}
controller.getConsole().show($table);}));(this.viewMode=="fixed")&&$nav.append($("<div>").class("close").bind("click",function(e){e.stopPropagation();self.getLayout().compact(self.onCompact);}));return this;};};})(forp,jMicro);(function(forp,$){"use strict";forp.Stack=function(stack)
{var self=this;this.stack=(stack.stack!=null)?stack.stack:[];this.utime=(stack.utime!=null)?stack.utime:null;this.stime=(stack.stime!=null)?stack.stime:null;this.inspect=stack.inspect;this.functions=null;this.includes=null;this.includesCount=0;this.groups=null;this.groupsCount=0;this.leaves=null;this.topCpu=null;this.topCalls=null;this.topMemory=null;this.found={};this.maxNestedLevel=0;this.avgLevel=0;var Function=function(conf)
{this.stack=conf.stack;this.id=conf.id;this.class=conf.class;this.function=conf.function;this.refs=[];this.entries=[];this.calls=1;this.duration=null;this.memory=null;this.setEntry=function(filelineno,entry)
{this.entries[filelineno]=entry;return this;};this.incrCalls=function()
{this.calls++;return this;};this.getDuration=function(){if(this.duration!==null)return this.duration;this.duration=0;for(var i in this.refs){if(this.isRecursive(this.refs[i]))continue;this.duration+=this.refs[i].usec;}
return this.duration;};this.getMemory=function(){if(this.memory!==null)return this.memory;this.memory=0;for(var i in this.refs){if(this.isRecursive(this.refs[i]))continue;this.memory+=this.refs[i].bytes;}
return this.memory;};this.isRecursive=function(entry)
{var i=entry.i;while(this.stack[i].parent>0){i=this.stack[i].parent;if(this.stack[i].id==entry.id)return true;}
return false;};}
this.refineParents=function(descendant,value)
{if(descendant.parent==undefined)return;this.stack[descendant.parent].usec-=value;this.refineParents(this.stack[descendant.parent],value);return this;};this.aggregate=function()
{if(!this.functions){var id,filelineno,ms,kb,lastEntry;this.functions={};this.includes={};this.groups={};this.leaves=[];this.topCpu=new $.SortedFixedArray(function(a,b){return(a.usec>b.usec);},20);this.topMemory=new $.SortedFixedArray(function(a,b){return(a.bytes>b.bytes);},20);for(var entry in this.stack){id=this.getEntryId(this.stack[entry]);filelineno=this.stack[entry].file+(this.stack[entry].lineno?':'+this.stack[entry].lineno:'');ms=$.roundDiv(this.stack[entry].usec,1000);kb=$.roundDiv(this.stack[entry].bytes,1024);this.stack[entry].i=entry;this.stack[entry].filelineno=filelineno;if(lastEntry&&(lastEntry.level>=this.stack[entry].level)){this.leaves.push(lastEntry)&&(lastEntry.leaf=this.leaves.length-1);this.topCpu.put(lastEntry);this.topMemory.put(lastEntry);}
this.maxNestedLevel=(this.stack[entry].level>this.maxNestedLevel)?this.stack[entry].level:this.maxNestedLevel;this.avgLevel+=this.stack[entry].level;this.stack[entry].id=id;if(this.stack[this.stack[entry].parent]){if(!this.stack[this.stack[entry].parent].childrenRefs){this.stack[this.stack[entry].parent].childrenRefs=[];}
this.stack[this.stack[entry].parent].childrenRefs.push(entry);}
if(this.functions[id]){this.functions[id].incrCalls();if(this.functions[id].entries[filelineno]){this.functions[id].entries[filelineno].calls++;}else{this.functions[id].setEntry(filelineno,{calls:1,file:this.stack[entry].file,filelineno:filelineno,refs:[]});}}else{this.functions[id]=new Function({stack:this.stack,id:id,class:this.stack[entry].class?this.stack[entry].class:null,function:this.stack[entry].function}).setEntry(filelineno,{calls:1,file:this.stack[entry].file,filelineno:filelineno,refs:[]});if(this.stack[entry].groups){for(var g in this.stack[entry].groups){if(!this.groups[this.stack[entry].groups[g]]){this.groups[this.stack[entry].groups[g]]={calls:0,usec:0,bytes:0,refs:[]};}
this.groups[this.stack[entry].groups[g]].refs.push(this.stack[entry]);}}}
this.functions[id].refs.push(this.stack[entry]);this.functions[id].entries[filelineno].refs.push(this.stack[entry]);this.stack[entry].pusec&&this.refineParents(this.stack[entry],this.stack[entry].pusec);if(!this.includes[this.stack[entry].file]){this.includes[this.stack[entry].file]={usec:ms,bytes:kb,calls:1};this.includesCount++;}else{this.includes[this.stack[entry].file].usec+=ms;this.includes[this.stack[entry].file].bytes+=kb;this.includes[this.stack[entry].file].calls++;}
lastEntry=this.stack[entry];}
this.leaves.push(lastEntry)&&(lastEntry.leaf=this.leaves.length-1);this.topCpu.put(lastEntry);this.topMemory.put(lastEntry);for(var group in this.groups){this.groupsCount++;for(var i in this.groups[group].refs){this.groups[group].calls+=this.functions[this.groups[group].refs[i].id].calls;this.groups[group].usec+=this.functions[this.groups[group].refs[i].id].getDuration();this.groups[group].bytes+=this.functions[this.groups[group].refs[i].id].getMemory();}}
this.avgLevel=this.avgLevel/this.stack.length;}
return this;};this.getMainEntry=function()
{return this.stack[0];};this.getEntryId=function(entry)
{return((entry.class)?entry.class+'::':'')+entry.function;};this.getFunctions=function()
{return this.aggregate().functions;};this.search=function(query)
{if(!this.found[query]){this.found[query]=[];for(var entry in this.getFunctions()){if(this.found[query].length==100)return this.found[query];var r=new RegExp(query,"i");if(r.test(this.functions[entry].id))
this.found[query].push(this.functions[entry]);}}
return this.found[query];};this.getTopCalls=function()
{if(!this.topCalls){this.topCalls=new $.SortedFixedArray(function(a,b){return(a.calls>b.calls);},20);for(var entry in this.getFunctions()){this.topCalls.put(this.functions[entry]);}}
return this.topCalls.stack;};this.getTopCpu=function()
{return this.aggregate().topCpu.stack;};this.getTopMemory=function()
{return this.aggregate().topMemory.stack;};this.getIncludes=function()
{return this.aggregate().includes;};this.getGroups=function()
{return this.aggregate().groups;};};})(forp,jMicro);(function(forp,$){"use strict";forp.Grader=function()
{this.grades={time:{A:{min:0,max:100,tip:["Very good job !","The planet will reward you !","You'll be the king at the coffee machine.","Your servers thanks you."]},B:{min:100,max:300,tip:["Good job !"]},C:{min:300,max:600,tip:["You are close to job performance."]},D:{min:600,max:1000,tip:["You are under one second.","Think cache."]},E:{min:1000,max:2000,tip:["At your own risk !"]}},memory:{A:{min:0,max:2000,tip:["Very good job !"]},B:{min:2000,max:4000,tip:["Good job !"]},C:{min:4000,max:8000,tip:["Respectable"]},D:{min:8000,max:12000,tip:["It seems that you load too much data."]},E:{min:12000,max:20000,tip:["It seems that you load too much data."]}},includes:{A:{min:0,max:5,tip:["Very good job !"]},B:{min:5,max:20,tip:["Good job !"]},C:{min:30,max:60,tip:["A builder script could do the rest."]},D:{min:60,max:120,tip:["A builder script could be your best friend on this."]},E:{min:120,max:240,tip:["At your own risk !","A builder script could be your best friend on this."]}},calls:{A:{min:0,max:2000,tip:["Very good job !","This is the 'Hello world' script ?"]},B:{min:2000,max:4000,tip:["Very good job !"]},C:{min:4000,max:8000,tip:["Respectable"]},D:{min:8000,max:16000,tip:["Has a bad impact on performance."]},E:{min:32000,max:64000,tip:["It's a joke ?","At your own risk !","Too many instructions."]}},nesting:{E:{min:0,max:5,tip:["This is the 'Hello world' script ?"]},A:{min:5,max:10,tip:["Good job !"]},B:{min:10,max:15,tip:["Respectable"]},C:{min:15,max:20,tip:["Respectable"]},D:{min:20,max:30,tip:["Perhaps, are you currently refactoring ?"]}}};this.getGrade=function(gradeName,mesure){for(var grade in this.grades[gradeName]){if(mesure>=this.grades[gradeName][grade]['min']&&mesure<=this.grades[gradeName][grade]['max']){return grade;}}
return grade;};this.getTip=function(gradeName,grade){var i=Math.floor((Math.random()*this.grades[gradeName][grade]['tip'].length));return this.grades[gradeName][grade]['tip'][i];};this.getClass=function(grade){return"grade-"+grade;};this.getGradeWithTip=function(gradeName,mesure){var grade=this.getGrade(gradeName,mesure);return $('<div>').append($('<div>').class(this.getClass(grade)).text(grade)).append($('<span>').text(this.getTip(gradeName,grade)));};};})(forp,jMicro);(function(forp,$){forp.TagRandColor={i:0,pocket:["#f95","#f59","#59f","#5e9","#9e6","#95f","#e55","#fe6","#f6f","#5e5","#5ef","#55f"],tagsColor:{},provideFor:function(name)
{if(!this.tagsColor[name]){if(this.i<this.pocket.length){this.tagsColor[name]=this.pocket[this.i];this.i++;}else{this.tagsColor[name]='rgb('+
Math.round(Math.random()*100+155)+','+
Math.round(Math.random()*100+155)+','+
Math.round(Math.random()*100+155)
+')';}}
return this.tagsColor[name];},provideElementFor:function(name)
{return $("<a>").class("tag").attr('style','background: '+this.provideFor(name)).text(name).bind("click",function(){});}};})(forp,jMicro);(function(forp,$){forp.ToggleButton=function(label,on,off,triggerOn)
{var self=this,$container=$("<div>");forp.Decorator.call(this,$container);this.$.text(typeof label=='function'?label():label).class("toggleOff").bind('click',function(e){if($(this).attr("data-state")=="on"){off&&(off(e)!==false)&&$(this).class("toggleOff").attr("data-state","off");}else{$(this).parent().find("div.toggleOn").each(function(){$(this).class("toggleOff").attr("data-state","off")});on&&(on(e)!==false)&&$(this).class("toggleOn").attr("data-state","on");}});triggerOn&&triggerOn()&&this.$.trigger("click");};})(forp,jMicro);(function(forp,$){forp.Graph=function(conf){forp.Decorator.call(this,$("<canvas>"));this.ctx=this.$[0].getContext('2d');this.drawn=false;this.conf=$.extend({width:100,xaxis:{length:100,min:0,max:0},yaxis:{length:100,min:0,max:0},mousemouve:null,val:function(i){return this.datas[i];},color:function(i){return'#999999';}},conf);this.datas=null;this.setDatas=function(datas){this.datas=datas;return this;};};})(forp,jMicro);(function(forp,$){$.Gauge=function(value,max,divider,unit)
{var percent=0,text,displayedValue;displayedValue=$.roundDiv(value,(divider?divider:1));if(value<0){displayedValue=Math.abs(displayedValue);}
if(displayedValue%1!==0){displayedValue=displayedValue.toFixed(3);}
displayedValue+=(unit?unit:'');if(value>max){text="reached "+displayedValue;}else if(value<0){text="won "+displayedValue;}else{text=displayedValue;percent=$.round(value*100/max);}
return $('<div>').addClass("gauge").append($("<div>").class("text").text(text)).append($("<div>").addClass("bar").attr("style","width: "+percent.toFixed(0)+"%"));};})(forp,jMicro);(function(forp,$){forp.BarChart=function(conf){forp.Graph.call(this,conf);this.tmp=null;this.restore=function(){if(this.tmp){this.ctx.clearRect(0,0,this.element.width,this.element.height);this.ctx.drawImage(this.tmp,0,0);}};this.highlight=function(idx){if(!this.tmp){this.tmp=document.createElement('canvas');this.tmp.width=this.element.width;this.tmp.height=this.element.height;this.tmp.style.width='100%';this.tmp.style.height='100px';var context=this.tmp.getContext('2d');context.drawImage(this.element,0,0);}
this.ctx.beginPath();this.ctx.strokeStyle='#4D90FE';this.ctx.lineWidth=60;this.ctx.moveTo(idx,this.conf.yaxis.length);this.ctx.lineTo(idx,this.conf.yaxis.length-
((this.conf.val.call(this,idx)*100)/this.conf.yaxis.max));this.ctx.closePath();this.ctx.stroke();};this.draw=function(){if(!this.drawn){this.drawn=true;var len=this.datas.length;this.element.width=document.body.clientWidth*2;this.element.height=this.conf.yaxis.length;this.element.style.width='100%';this.element.style.height=this.conf.yaxis.length+'px';this.element.style.marginBottom='-3px';this.element.style.backgroundColor='#333';var x=0;for(var i=0;i<len;i++){this.ctx.beginPath();this.ctx.strokeStyle=this.conf.color.call(this,i);this.ctx.lineWidth=50;this.ctx.moveTo(x,25);this.ctx.lineTo(x+=((this.conf.val.call(this,i)*this.element.width)/this.conf.xaxis.max)+2,25);this.ctx.closePath();this.ctx.stroke();}
if(this.conf.mousemove){var self=this;this.bind('mousemove',function(e){self.conf.mousemove.call(self,e);})}}
return this;};};})(forp,jMicro);(function(forp,$){forp.Histogram=function(conf){forp.Graph.call(this,conf);this.tmp=null;this.restore=function(){if(this.tmp){this.ctx.clearRect(0,0,this.element.width,this.element.height);this.ctx.drawImage(this.tmp,0,0);}};this.highlight=function(idx){if(!this.tmp){this.tmp=document.createElement('canvas');this.tmp.width=this.element.width;this.tmp.height=this.element.height;this.tmp.style.width='100%';this.tmp.style.height=this.conf.yaxis.length+'px';var context=this.tmp.getContext('2d');context.drawImage(this.element,0,0);}
this.ctx.beginPath();this.ctx.strokeStyle='#4D90FE';this.ctx.lineWidth=3;this.ctx.moveTo(idx,this.conf.yaxis.length);this.ctx.lineTo(idx,this.conf.yaxis.length-
((this.conf.val.call(this,idx)*this.conf.yaxis.length)/this.conf.yaxis.max));this.ctx.closePath();this.ctx.stroke();};this.draw=function(){if(!this.drawn){this.drawn=true;var len=this.datas.length;this.element.width=len;this.element.height=this.conf.yaxis.length;this.element.style.width='100%';this.element.style.height=this.conf.yaxis.length+'px';this.element.style.marginBottom='-3px';this.element.style.backgroundColor='#333';this.ctx.beginPath();for(var i=0;i<len;i++){this.ctx.strokeStyle=this.conf.color.call(this,i);this.ctx.lineWidth=3;this.ctx.moveTo(i,this.conf.yaxis.length);this.ctx.lineTo(i,this.conf.yaxis.length-
((this.conf.val.call(this,i)*this.conf.yaxis.length)/this.conf.yaxis.max));}
this.ctx.closePath();this.ctx.stroke();if(this.conf.mousemove){var self=this;this.$.bind('mousemove',function(e){self.conf.mousemove.call(self,e);})}}
return this;};};})(forp,jMicro);(function(forp,$){forp.Layout=function($container,viewMode)
{var self=this;forp.Decorator.call(this,$container);$container.attr("id","forp");this.mainpanel=null;this.nav=null;this.viewMode=viewMode;this.conf={fixed:{size:function(){self.$.attr("style","");self.getConsole().$.attr("style","height: "+(self.$.height()-45)+"px");if(self.getConsole().hasSidebar()){self.getConsole().getSidebar().$.attr("style","height: "+(self.$.height()-45)+"px");}
if(window.onresize==null){window.onresize=function(e){self.size();}}},reduce:function(){self.$.attr("style","height: 45px");}},embedded:{size:function(){self.$.attr("style","height: 100%");self.getConsole().$.attr("style","height: "+(self.$.height()-45)+"px");if(self.getConsole().hasSidebar()){self.getConsole().getSidebar().$.attr("style","height: "+(self.$.height()-45)+"px");}},reduce:function(){return false}}};this.setViewMode=function(viewMode)
{this.viewMode=viewMode;return this;};this.getMainPanel=function()
{if(!this.mainpanel){this.mainpanel=(new forp.MainPanel(this)).appendTo(this);}
return this.mainpanel;};this.getNav=function()
{if(!this.nav){this.nav=(new forp.Nav()).appendTo(this);}
return this.nav;};this.getConsole=function()
{return this.getMainPanel().getConsole();};this.open=function()
{this.$.class("forp-"+this.viewMode);return this;};this.size=function(){return(this.conf[this.viewMode].size()!==false);};this.reduce=function(){return(self.conf[self.viewMode].reduce()!==false);};this.compact=function(callback)
{this.$.attr("style","").empty().class("forp-"+this.viewMode+"-compact");this.nav=null;this.mainpanel=null;callback();return this;};};})(forp,jMicro);(function(forp,$){forp.MainPanel=function(layout)
{var self=this;forp.Panel.call(this,"mainpanel");this.console=null;this.layout=layout;this.getConsole=function()
{if(!this.console){this.console=(new forp.Console(this)).appendTo(this);}
return this.console;};this.open=function(){this.layout.size();return this;};this.close=function(){self.css("height: 0px",function(){});return this;};};})(forp,jMicro);(function(forp,$){forp.Console=function(parent)
{var self=this;forp.Panel.call(this,"console");this.sidebar=null;this.parent=parent;this.open=function(){this.closeSidebar();this.parent.open();return this;};this.show=function($content){return this.open().$.empty().append($content);};this.hasSidebar=function(){return(this.sidebar!=null);};this.showInSidebar=function($content){return this.openSidebar().$.empty().append($content);};this.getSidebar=function(){if(!this.sidebar){this.sidebar=new forp.Sidebar(this.parent);this.parent.append(this.sidebar).layout.size();}
return this.sidebar;};this.openSidebar=function(){this.$.addClass("w2of3");return this.getSidebar().open();};this.closeSidebar=function(){this.$.removeClass("w2of3");if(this.sidebar){this.sidebar.close();}
return this;};};})(forp,jMicro);(function(forp,$){forp.Sidebar=function(parent)
{forp.Panel.call(this,"sidebar");this.parent=parent;this.open=function(){this.$.addClass("w1of3");return this;}
this.close=function(){this.$.empty().removeClass("w1of3");return this;}};})(forp,jMicro);(function(forp,$){forp.Backtrace=function(i,stack)
{var self=this,$container=$("<div>").class("backtrace");forp.Decorator.call(this,$container);this.prependItem=function(entry,highlight){return this.$.prepend($("<div>").class("backtrace-item "+(highlight?" highlight":"")).append($('<span>').class('strong').text(entry.id)).append($('<br>')).append($('<span>').text($.Utils.trimPath(entry.filelineno))).append($('<br>')).append($('<span>').text($.roundDiv(entry.usec,1000).toFixed(3)+"ms ")).append($('<span>').text($.roundDiv(entry.bytes,1024).toFixed(3)+"Kb")));};var child=i;while(i!=null){this.prependItem(stack[i],child==i);i=stack[i].parent;if(i!=null){this.$.prepend($("<div>").class("arrow").text("&#x25BC;"));}}};})(forp,jMicro);(function(forp,$){$.tree=function(stack)
{var self=this;this.treeList=function(entry,recursive)
{var ul=$("<ul>").addClass("l"+entry.level),ex=$("<div>").html("<span>&nbsp;</span>").addClass("left expander"),gd=($.Gauge(entry.usec,stack[entry.parent]?stack[entry.parent].usec:entry.usec,1000,'ms')).addClass("left"),gb=($.Gauge(entry.bytes,stack[entry.parent]?stack[entry.parent].bytes:entry.bytes,1024,'Kb')).addClass("left"),li=$("<li>").text(entry.id);if(entry.groups){for(var g in entry.groups){li.append(forp.TagRandColor.provideElementFor(entry.groups[g]));}}
if(entry.caption)li.append($("<span>").text(entry.caption));li.append(ex).append(gd).append(gb).appendTo(ul);if(entry.childrenRefs){li.removeClass("expanded").addClass("collapsed");ex.bind('click',function(){if(li.hasClass("expanded")){li.removeClass("expanded").addClass("collapsed");}else{li.removeClass("collapsed").addClass("expanded");if(!li.attr("data-tree")){for(var i in entry.childrenRefs){self.treeList(stack[entry.childrenRefs[i]],true).appendTo(li);}
li.attr("data-tree",1);}}});if(parseInt(entry.level)<2){li.removeClass("collapsed").addClass("expanded");if(!li.attr("data-tree")){li.attr("data-tree",1);var loopCounter,lastId,loopMaxIter=100;for(var i in entry.childrenRefs){if(stack[entry.childrenRefs[i]].id==lastId){loopCounter++;}else{loopCounter=0;}
lastId=stack[entry.childrenRefs[i]].id;if(loopCounter==loopMaxIter){$("<ul>").append($("<li>").append(ex).append($("<div>").text(lastId+" : too many items to display (>"+loopMaxIter+")"))).appendTo(li);continue;}
if(loopCounter<loopMaxIter){this.treeList(stack[entry.childrenRefs[i]]).appendTo(li);}}}}else{li.removeClass("expanded").addClass("collapsed");}}
return ul;};return this.treeList(stack[0],true);};})(forp,jMicro);(function(forp,$){forp.plugins.inspector={'nav':{'label':'inspector','display':function(){return(forp.getController().getStack().inspect!=null);},'enabled':function(){return(forp.getController().getStack().inspect!=null);},'open':function(e){var self=forp.getController(),$table=$.table(["var","type"]),ivars=self.getStack().inspect;for(var ivar in ivars){var info;if(typeof(ivars[ivar])==="object"&&ivars[ivar].properties){info=$('<div>');for(var prop in ivars[ivar].properties){info.append($('<span>').text(prop));}}else{info=$.Utils.htmlEntities(ivars[ivar].value);}
$table.line([ivar,ivars[ivar].type]).attr('data-ref',ivar).bind('click',function(){var $ul=$("<ul>").class("inspect"),ivar=$(this).attr('data-ref'),list=function(v,ul){for(var entry in v){var el=$("<li>");if(typeof(v[entry])=='object'){ul.append(el.text(entry+":"));var sul=$("<ul>").appendTo(el);if(v[entry].type){switch(v[entry].type){case"string":case"int":case"bool":ul.append(el.text(entry+": ("
+v[entry].type
+") "
+$.Utils.htmlEntities(v[entry].value)));break;default:list(v[entry],sul);}}else{list(v[entry],sul);}}else{ul.append(el.text(entry+": "+$.Utils.htmlEntities(v[entry])));}}};list(forp.getController().getStack().inspect[ivar],$ul);forp.getController().getConsole().showInSidebar($ul);});}
self.getConsole().show($table);},'close':function(){forp.getController().getLayout().reduce();}}};})(forp,jMicro);(function(forp,$){forp.plugins.metrics={'nav':{'label':'metrics','display':true,'enabled':function(){return(forp.getController().getStack().inspect==null);},'open':function(e){var controller=forp.getController(),$table=$.table(["metric","type","value","grade"]),duration=$.roundDiv(controller.getStack().getMainEntry().usec,1000),memory=$.roundDiv(controller.getStack().getMainEntry().bytes,1024);$table.line([$('<span>').class('strong').text('Real time (ms)'),"Performance",duration+'',controller.getGrader().getGradeWithTip("time",duration)]);if(controller.getStack().utime!=null){var time=(controller.getStack().utime+controller.getStack().stime)/1000;$table.line(["<span class='strong'>CPU time (ms)</span>","Performance",time+'',controller.getGrader().getGradeWithTip("time",time)]);}
$table.line(["<span class='strong'>Memory usage (Kb)</span>","Performance",memory+'',controller.getGrader().getGradeWithTip("memory",memory)]);$table.line(["<span class='strong'>Total includes</span>","Performance",controller.getStack().includesCount+'',controller.getGrader().getGradeWithTip("includes",controller.getStack().includesCount)]);$table.line(["<span class='strong'>Total calls</span>","Performance",controller.getStack().stack.length+'',controller.getGrader().getGradeWithTip("calls",controller.getStack().stack.length)]);$table.line(["<span class='strong'>Max nested level</span>","Nesting",controller.getStack().maxNestedLevel+'',controller.getGrader().getGradeWithTip("nesting",controller.getStack().maxNestedLevel)]);$table.line(["<span class='strong'>Avg nested level</span>","Nesting",controller.getStack().avgLevel.toFixed(2)+'',controller.getGrader().getGradeWithTip("nesting",controller.getStack().avgLevel)]);controller.getConsole().show($table);},'close':function(){return forp.getController().getLayout().reduce;}}};})(forp,jMicro);(function(forp,$){forp.plugins.stack={'nav':{'label':function(){return"stack ("+forp.getController().getStack().stack.length+")";},'display':true,'enabled':false,'open':function(e){var controller=forp.getController();if(!controller.tree)
controller.tree=$.tree(controller.getStack().stack);controller.getConsole().show($("<div>").attr("style","margin-top: 10px;").append((new forp.ToggleButton("collapse",function(e){$("li.expanded").each(function(e){e.attr("class","collapsed");});},function(e){$("li.collapsed[data-tree]").each(function(e){e.attr("class","expanded");});return true;})).$.attr("style","position: absolute; margin: 5px; right: 20px")).append($("<div>").append(controller.tree)));},'close':function(){forp.getController().getLayout().reduce();}}};})(forp,jMicro);(function(forp,$){forp.plugins.duration={'nav':{'label':"top 20 duration",'display':true,'enabled':false,'open':function(e){var controller=forp.getController(),datas=controller.getStack().getTopCpu(),$table=$.table(["function","self cost ms","total cost ms","calls"]);controller.getConsole().empty();(controller.getStack().leaves.length>100)&&controller.getCpuHistogram().appendTo(controller.getConsole());for(var i in datas){var id=controller.getStack().getEntryId(datas[i]);$table.line([$('<span>').class('strong').text(datas[i].id).append($('<span>').text("("+datas[i].filelineno+")")).append(datas[i].caption?$("<div>").text(datas[i].caption):null),$.roundDiv(datas[i].usec,1000).toFixed(3)+'',$.roundDiv(controller.getStack().getFunctions()[id].getDuration(),1000).toFixed(3)+'',controller.getStack().getFunctions()[id].calls]).attr('data-ref',datas[i].i).bind('click',function(){forp.getController().getConsole().showInSidebar((new forp.Backtrace($(this).attr("data-ref"),forp.getController().getStack().stack)).$).scrollBottom();}).bind('mouseover',function(){controller.getCpuHistogram().highlight(controller.getStack().stack[$(this).attr('data-ref')].leaf);}).bind('mouseout',function(){controller.getCpuHistogram().restore();});}
$table.appendTo(controller.getConsole().$);},'close':function(){forp.getController().getLayout().reduce();}}};})(forp,jMicro);(function(forp,$){forp.plugins.memory={'nav':{'label':'top 20 memory','display':true,'enabled':false,'open':function(e){var controller=forp.getController(),datas=controller.getStack().getTopMemory();controller.getConsole().empty();(controller.getStack().leaves.length>100)&&controller.getMemoryHistogram().appendTo(controller.getConsole());var $table=$.table(["function","self cost Kb","total cost Kb","calls"]);for(var i in datas){var id=controller.getStack().getEntryId(datas[i]);$table.line([$('<span>').class('strong').text(datas[i].id).append($('<span>').text("("+datas[i].filelineno+")")).append(datas[i].caption?$("<div>").text(datas[i].caption):null),$.roundDiv(datas[i].bytes,1024).toFixed(3)+'',$.roundDiv(controller.getStack().getFunctions()[id].getMemory(),1024).toFixed(3)+'',controller.getStack().getFunctions()[id].calls]).attr('data-ref',datas[i].i).bind('click',function(){forp.getController().getConsole().showInSidebar((new forp.Backtrace($(this).attr("data-ref"),forp.getController().getStack().stack)).$).scrollBottom();}).bind('mouseover',function(){controller.getMemoryHistogram().highlight(controller.getStack().stack[$(this).attr('data-ref')].leaf);}).bind('mouseout',function(){controller.memoryHistogram.restore();});}
$table.appendTo(controller.getConsole().$);},'close':function(){forp.getController().getLayout().reduce();}}};})(forp,jMicro);(function(forp,$){forp.plugins.calls={'nav':{'label':"top 20 calls",'display':true,'enabled':false,'open':function(e){var controller=forp.getController(),datas=controller.getStack().getTopCalls(),$table=$.table(["function","calls","ms","Kb"]);for(var i in datas){$table.line([datas[i].id,datas[i].calls,$.roundDiv(datas[i].getDuration(),1000).toFixed(3)+'',$.roundDiv(datas[i].getMemory(),1024).toFixed(3)+'']).attr("data-ref",datas[i].id).bind("click",forp.getController().toggleDetails);}
controller.getConsole().show($table);},'close':function(){forp.getController().getLayout().reduce();}}};})(forp,jMicro);(function(forp,$){forp.plugins.groups={'nav':{'label':function(){return"groups ("+forp.getController().getStack().groupsCount+")";},'display':function(){return forp.getController().getStack().groupsCount>0;},'enabled':false,'open':function(e){var self=forp.getController(),datas=self.getStack().getGroups();self.getConsole().empty().open();self.getGroupsBarChart().appendTo(self.getConsole());var $table=$.table(["group","calls","ms","Kb"]);for(var i in datas){$table.append($("<tr>").append($("<td>").attr("colspan",4).attr("style","padding: 0px; height: 4px; background:"
+forp.TagRandColor.provideFor(i)))).line([datas[i].calls,$.roundDiv(datas[i].usec,1000).toFixed(3)+'',$.roundDiv(datas[i].bytes,1024).toFixed(3)+'']).prepend($("<td>").append(forp.TagRandColor.provideElementFor(i)).append($("<span>").append($("<span>").class('strong').text(i)).append($("<span>").text(' ('+datas[i].refs.length+' '+(datas[i].refs.length>1?"entries":"entry")+')'))));for(var j in datas[i].refs){$table.line([datas[i].refs[j].id,$.Gauge(self.getStack().getFunctions()[datas[i].refs[j].id].calls,datas[i].calls),$.Gauge(self.getStack().getFunctions()[datas[i].refs[j].id].getDuration(),datas[i].usec,1000,'ms'),$.Gauge(self.getStack().getFunctions()[datas[i].refs[j].id].getMemory(),datas[i].bytes,1024,'Kb')]).attr("data-ref",datas[i].refs[j].id).bind("click",self.toggleDetails);}}
self.getConsole().show($table);},'close':function(){forp.getController().getLayout().reduce();}}};})(forp,jMicro);(function(forp,$){forp.plugins.files={'nav':{'label':'files','display':function(){return forp.getController().getStack().includesCount>0;},'enabled':false,'open':function(e){var controller=forp.getController(),datas=controller.getStack().getIncludes();var $table=$.table(["file","calls from"]);for(var i in datas){$table.line([i,$.Gauge(datas[i].calls,controller.getStack().stack.length)]);}
controller.getConsole().show($table);},'close':function(){forp.getController().getLayout().reduce();}}};})(forp,jMicro);